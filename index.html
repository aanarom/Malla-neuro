<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Malla Curricular - Neurofisiología Clínica (UDELAR)</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fef6fb;
      color: #4a3b4f;
      margin: 0;
      padding: 1em;
    }
    h1 {
      text-align: center;
      color: #a85ca5;
    }
    .malla {
      display: flex;
      gap: 1em;
      justify-content: center;
      flex-wrap: wrap;
    }
    .anio {
      display: flex;
      flex-direction: column;
      gap: 0.5em;
      padding: 1em;
      background-color: #f8e9f9;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .anio h2 {
      margin-top: 0;
      text-align: center;
      color: #8e5c99;
    }
    .materia {
      padding: 0.6em;
      border-radius: 8px;
      cursor: pointer;
      background-color: #f1d4f6;
      transition: all 0.3s;
      position: relative;
    }
    .materia.aprobada {
      background-color: #d6a8e2;
      text-decoration: line-through;
    }
    .materia.bloqueada {
      background-color: #eee;
      color: #999;
      cursor: not-allowed;
    }
    .materia[title]::after {
      content: attr(title);
      position: absolute;
      bottom: 100%;
      left: 0;
      right: 0;
      background-color: #fff0ff;
      color: #7a4e8c;
      padding: 0.4em;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      font-size: 0.75em;
      display: none;
    }
    .materia:hover[title]::after {
      display: block;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular - Neurofisiología Clínica (UDELAR)</h1>
  <div class="malla" id="malla"></div>

  <script>
    const materias = [
      { nombre: "Biología Celular y Tisular", anio: 1, previas: [] },
      { nombre: "Anatomía", anio: 1, previas: [] },
      { nombre: "Reproductor y Desarrollo", anio: 1, previas: [] },
      { nombre: "Neurobiología", anio: 1, previas: [] },
      { nombre: "Profundización", anio: 1, previas: [] },
      { nombre: "Digestivo, Renal y Endócrino", anio: 1, previas: [] },
      { nombre: "Cardiovascular y Respiratorio", anio: 1, previas: [] },
      { nombre: "Psicología", anio: 1, previas: [] },
      { nombre: "Metodología Científica", anio: 1, previas: [] },
      { nombre: "Enfermería", anio: 1, previas: [] },
      { nombre: "Salud Pública", anio: 1, previas: [] },

      { nombre: "Introducción a las Técnicas de Registro", anio: 2, previas: ["Biología Celular y Tisular", "Anatomía", "Reproductor y Desarrollo", "Neurobiología", "Profundización", "Digestivo, Renal y Endócrino", "Cardiovascular y Respiratorio"] },
      { nombre: "Física Electrónica", anio: 2, previas: ["Biología Celular y Tisular", "Anatomía", "Reproductor y Desarrollo", "Neurobiología", "Profundización", "Digestivo, Renal y Endócrino", "Cardiovascular y Respiratorio"] },
      { nombre: "Clínica Neurológica", anio: 2, previas: ["Biología Celular y Tisular", "Anatomía", "Reproductor y Desarrollo", "Neurobiología", "Profundización", "Digestivo, Renal y Endócrino", "Cardiovascular y Respiratorio"] },
      { nombre: "Neurofisiología Básica y Experimental", anio: 2, previas: ["Biología Celular y Tisular", "Anatomía", "Reproductor y Desarrollo", "Neurobiología", "Profundización", "Digestivo, Renal y Endócrino", "Cardiovascular y Respiratorio"] },
      { nombre: "Farmacología", anio: 2, previas: ["Biología Celular y Tisular", "Anatomía", "Reproductor y Desarrollo", "Neurobiología", "Profundización", "Digestivo, Renal y Endócrino", "Cardiovascular y Respiratorio"] },
      { nombre: "Neurofisiología Clínica II", anio: 2, previas: ["Biología Celular y Tisular", "Anatomía", "Reproductor y Desarrollo", "Neurobiología", "Profundización", "Digestivo, Renal y Endócrino", "Cardiovascular y Respiratorio", "Neurofisiología Básica y Experimental"] },
      { nombre: "Deontología y Legislación", anio: 2, previas: [] },
      { nombre: "Administración Hospitalaria", anio: 2, previas: [] },

      { nombre: "Neurofisiología Clínica I", anio: 3, previas: ["Biología Celular y Tisular", "Anatomía", "Reproductor y Desarrollo", "Neurobiología", "Profundización", "Digestivo, Renal y Endócrino", "Cardiovascular y Respiratorio"] },
      { nombre: "Electroencefalograma en el Niño y Adulto", anio: 3, previas: ["Introducción a las Técnicas de Registro"] },
      { nombre: "Potenciales Evocados", anio: 3, previas: ["Introducción a las Técnicas de Registro", "Neurofisiología Básica y Experimental", "Clínica Neurológica"] },
      { nombre: "Informática en Neurofisiología", anio: 3, previas: [] },

      { nombre: "Electroencefalografía Cuantitativa y Digital", anio: 4, previas: ["Biología Celular y Tisular", "Anatomía", "Reproductor y Desarrollo", "Neurobiología", "Profundización", "Digestivo, Renal y Endócrino", "Cardiovascular y Respiratorio"] },
      { nombre: "Estudios del Sistema Periférico", anio: 4, previas: ["Introducción a las Técnicas de Registro", "Neurofisiología Clínica II", "Clínica Neurológica", "Neurofisiología Básica y Experimental"] },
      { nombre: "Polisomnografía en el Niño y el Adulto", anio: 4, previas: ["Neurofisiología Clínica II", "Electroencefalograma en el Niño y Adulto"] },
      { nombre: "Monografía", anio: 4, previas: "TODAS" }
    ];

    const contenedor = document.getElementById("malla");
    const aprobadas = new Set(JSON.parse(localStorage.getItem("materiasAprobadas") || "[]"));

    function crearMalla() {
      contenedor.innerHTML = "";
      const anios = [...new Set(materias.map(m => m.anio))].sort();

      anios.forEach(anio => {
        const columna = document.createElement("div");
        columna.className = "anio";

        const titulo = document.createElement("h2");
        titulo.textContent = `Año ${anio}`;
        columna.appendChild(titulo);

        materias.filter(m => m.anio === anio).forEach(materia => {
          const div = document.createElement("div");
          div.className = "materia";
          div.textContent = materia.nombre;
          div.dataset.nombre = materia.nombre;

          if (!puedeDesbloquearse(materia)) {
            div.classList.add("bloqueada");
            div.title = tooltipFaltantes(materia);
          } else if (aprobadas.has(materia.nombre)) {
            div.classList.add("aprobada");
          }

          div.addEventListener("click", () => {
            if (!div.classList.contains("bloqueada")) {
              div.classList.toggle("aprobada");
              if (div.classList.contains("aprobada")) {
                aprobadas.add(materia.nombre);
              } else {
                aprobadas.delete(materia.nombre);
              }
              guardarProgreso();
              crearMalla();
            }
          });

          columna.appendChild(div);
        });

        contenedor.appendChild(columna);
      });
    }

    function puedeDesbloquearse(materia) {
      if (materia.previas === "TODAS") {
        return materias.every(m => m.nombre === materia.nombre || aprobadas.has(m.nombre));
      }
      return materia.previas.every(p => aprobadas.has(p));
    }

    function tooltipFaltantes(materia) {
      if (materia.previas === "TODAS") {
        return "Requiere aprobar todas las demás materias.";
      }
      const faltan = materia.previas.filter(p => !aprobadas.has(p));
      return faltan.length ? "Faltan: " + faltan.join(", ") : "";
    }

    function guardarProgreso() {
      localStorage.setItem("materiasAprobadas", JSON.stringify([...aprobadas]));
    }

    crearMalla();
  </script>
</body>
</html>
